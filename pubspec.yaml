name: mapsforge_flutter
publish_to: none
environment:
  sdk: ^3.9.0
dev_dependencies:
  melos: ^7.1.0
workspace:
  - packages/task_queue
  - packages/dart_isolate
  - packages/dart_common
  - packages/dart_mapfile
  - packages/dart_rendertheme
  - packages/datastore_renderer
  - packages/mapsforge_assets
  - packages/mapsforge_view
  - apps/mapfile_converter
  - apps/simple_example

melos:
  scripts:
    build:
      description: Generates dart files
      run: dart run build_runner build --delete-conflicting-outputs
      packageFilters:
        dependsOn: build_runner

    bootstrap:
      dependencies:
        # Upgraded for getOrProduceSync()
        ecache: ^2.0.10

        # flutter_test is not compatible with newer versions currently (08/2025)
        test: ^1.26.2
      hooks:
        post: flutter pub upgrade


    flutter_test:
      run: melos exec -c 1 --dir-exists="test" --flutter --fail-fast -- flutter test --no-pub --coverage
      description: Run Flutter tests for a specific package in this project.
      select-package:
        flutter: true
        dir-exists: test


    dart_test:
      run: melos exec -c 1 --dir-exists="test" --depends-on="test" --fail-fast -- dart test
      description: Run Dart tests for a specific package in this project.
      select-package:
        flutter: false
        dir-exists: test